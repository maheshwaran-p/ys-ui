<!DOCTYPE html>
<html lang="en">

<head>
    <script src="js/login.js"></script>

    <meta charset=UTF-8>
    <script src="js/register.js"></script>
    <script src="js/staff.js"></script>
    <script src="js/mark.js"></script>
    <link rel="stylesheet" href="css/login.css">
    <script src="js/register.js"></script>


    <title>Marks</title>


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    <link rel="stylesheet" href="css/mark.css">


    <header>
        <h5 align="center" style="color: #fff;">Marks</h5>
        <div align="right" class="right_area">
            <a onclick="newcours()" class="logout_bt">Add New Course</a>
        </div>
    </header>
</head>

<body>
    <h1 align="center">Validate</h1>

    <div class="container">
        <div class="row">

            <div class="col-md-4 col-xl-6" onclick="cour()">
                <div class="card bg-c-green order-card">
                    <div class="card-block">
                        <h6 class="m-b-20"><a style="text-decoration: none;color:white;">

                                Courses</a> </h6>
                        <h2 class="text-right"><i class="fas fa-eye f-left"></i></h2>

                    </div>
                </div>
            </div>
            <div class="col-md-4 col-xl-6" onclick="note()">
                <div class="card bg-c-blue order-card">
                    <div class="card-block">
                        <h6 class="m-b-20"> <a style="text-decoration: none;color:white;">

                                Notes</a> </h6>
                        <h2 class="text-right"><i class="fas fa-plus f-left"></i></h2>

                    </div>
                </div>

            </div>


            <div class="col-md-4 col-xl-6" onclick="">
                <div class="card bg-c-blue order-card">
                    <div class="card-block">
                        <h6 class="m-b-20"> <a style="text-decoration: none;color:white;">

                                Validate</a> </h6>
                        <h2 class="text-right"><i class="fas fa-plus f-left"></i></h2>

                    </div>
                </div>
            </div>


        </div>
    </div>
    </div>

    <div id="dvTable" align="center">





    </div>


    <br><br> <br><br>
    <input type="text" id="total" name="total" value="" placeholder="Tatal Mark for this Course" required>
    <br><br> <br>

    <input align="center" type="button" class="button" onclick="mark1()" value="Update Marks">
    <div id="snackbar">Total Mark is required</div>



    <br><br> <br><br> <br><br> <br><br> <br><br> <br><br>

    <script>

        window.onload = tabledata();



        function newcourse() {


            window.location.href = "./addnewcourse.html";

        }



        function note() {

            window.location.href = "./staff-note.html";

        }

        function cour() {

            window.location.href = "./staff-base.html";

        }

        arr1 = [];

        marks = [];

        ids = [];


        function mark1() {
            var total = document.getElementById('total').value;

            if (total != '') {



                let urlString =
                    window.location.href;
                let paramString = urlString.split('?')[1];
                let queryString = new URLSearchParams(paramString);
                let pair = []
                for (pair of queryString.entries()) {
                    console.log("Key is:" + pair[0]);
                    console.log("Value is:" + pair[1]);
                }
                for (var k = 0; k < ids.length; k++) {
                    mark = document.getElementById(ids[k]).value;
                    marks.push(mark);
                }
                console.log("lenght:" + marks.length);


                console.log(marks[0]);
                console.log(marks[1]);

                ids.reverse();
                // console.log(ids[0]);

                studentMark = {};

                var jsonArray = [];

                for (let i = 0; i < ids.length; i++) {

                    studentMark.studentId = ids[i];
                    studentMark.mark = marks[i];

                    jsonArray.push({ ...studentMark });

                }

                postMarks(pair[1], jsonArray);

            }
            else {
                var x = document.getElementById("snackbar");
                x.className = "show";
                setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
            }

        }

        async function tabledata() {

            let urlString =
                window.location.href;
            let paramString = urlString.split('?')[1];
            let queryString = new URLSearchParams(paramString);
            let pair = [];
            marksfromserver = [];
            for (pair of queryString.entries()) {
                console.log("Key is:" + pair[0]);
                console.log("Value is:" + pair[1]);
            }
            await fetch(BASEURL + '/marks/get/' + pair[1]).then(function (response) {
                return response.json();

            }).then(function (obj) {

                console.log(obj);

                console.log(obj[0].mark);

                for (var i = 0; i < obj.length; i++) {
                    marksfromserver.push(obj[i].mark);

                }

            }).catch(function (error) {
                console.log(error);
            })

            await fetch(BASEURL + '/student/get').then(function (response) {
                return response.json();

            }).then(function (obj) {


                var courses = new Array();


                console.log(obj);




                courses.push(["Student    ", " Marks",]);

                for (var i = 0; i < obj.length; i++) {

                    console.log("bye");


                    var user = obj[i].username;


                    let id1 = obj[i].id;
                    console.log(obj[i].username);


                    let link_attributes = {
                        target: '_blank',
                        class: 'mylink',
                        rel: 'nofollow noopener'
                    };



                    //  let result = convert_url(co, link_attributes);


                    // let result2 = convert_url(staff, link_attributes);

                    //   let result3 = convert_url3(id1, "https://delete/course/", link_attributes);

                    // console.log(result3);


                    courses.push([user])



                }



                for (var i = 0; i < obj.length; i++)
                    ids.push(obj[i].id);



                arr1.push(courses[0]);

                for (let i = courses.length - 1; i > 0; i--) {
                    arr1.push(courses[i]);
                }


                var table = document.createElement("TABLE");
                table.border = "8";

                //Get the count of columns.
                var columnCount = arr1[0].length;

                //Add the header row.
                var row = table.insertRow(-1);
                for (var i = 0; i < columnCount; i++) {
                    var headerCell = document.createElement("TH");
                    headerCell.innerHTML = arr1[0][i];

                    row.appendChild(headerCell);
                }

                //Add the data rows.
                for (var i = 1; i < arr1.length; i++) {
                    row = table.insertRow(-1);
                    // console.log(obj[i - 1].id);
                    for (var j = 0; j < columnCount; j++) {
                        var cell = row.insertCell(-1);
                        cell.innerHTML = arr1[i][j];
                        if (j != 0) {
                            cell.innerHTML = `<div><input  id="${obj[i - 1].id}" value="${marksfromserver[i - 1]}" type="number"></div>`



                            // mark = arr1[i][j];

                            // marks.push(mark);
                        }
                        // cell.innerHTML = cell.innerHTML;
                        // mark = document.getElementById("marks").value;

                        // marks.push(mark);



                    }
                }


                //console.log("mark......" + marks[0])



                var dvTable = document.getElementById("dvTable");
                dvTable.innerHTML = "";
                dvTable.appendChild(table);
            }).catch(function (error) {
                console.log("Error...");

            })


        }


        function taketest(course) {

            console.log(course);
            window.location.href = "course";
        }



        function convert_url3(id1, text, link_attributes_obj = {}) {


            console.log("id::::" + id1);

            text = text.replace(/</g, '&lt;');
            text = text.replace(/>/g, '&gt;');

            let attr = [];
            for (let k in link_attributes_obj) {
                if (k !== 'href') {
                    attr.push(k + '="' + link_attributes_obj[k].replaceAll(/"/g, "'") + '"');
                }
            }

            //URLs starting with http://, https://, or ftp://
            let exp = /((?:https?|ftp):\/\/[a-zA-Z0-9][\w+\d+&@\-#\/%?=~_|!:,.;+]*)/gim;
            text = text.replace(exp, '<a onclick="javascript: getCourse(\'' + id1 + '\')  ">validate</a>');

            //URLs starting with www.
            let reg_ww = /(?<!\/)(www\.[a-zA-Z0-9][\w+\d+&@\-#\/%?=~_|!:,.;+]*)/gim;
            text = text.replace(reg_ww, '<a onclick="javascript: getCourse(\'' + id1 + '\')">validate</a>');
            // deleteCourse(id1);


            return text;
        }


        function convert_url(text, link_attributes_obj = {}) {
            //link_attributes_obj (optional) object {target:'_blank', class:'myLink'}

            //html to text
            text = text.replace(/</g, '&lt;');
            text = text.replace(/>/g, '&gt;');

            let attr = [];
            for (let k in link_attributes_obj) {
                if (k !== 'href') {
                    attr.push(k + '="' + link_attributes_obj[k].replaceAll(/"/g, "'") + '"');
                }
            }

            //URLs starting with http://, https://, or ftp://
            let exp = /((?:https?|ftp):\/\/[a-zA-Z0-9][\w+\d+&@\-#\/%?=~_|!:,.;+]*)/gim;
            text = text.replace(exp, '<a href="$1" ' + attr.join(' ') + '>View Response</a>');

            //URLs starting with www.
            let reg_ww = /(?<!\/)(www\.[a-zA-Z0-9][\w+\d+&@\-#\/%?=~_|!:,.;+]*)/gim;
            text = text.replace(reg_ww, '<a href="https://$1" ' + attr.join(' ') + '>View Response</a>');

            return text;
        }

    </script>

</body>

</html>